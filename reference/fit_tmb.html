<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="fit_tmb runs a TMB model and generates standard diagnostics"><title>Optimize a TMB model — fit_tmb • FishLife</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimize a TMB model — fit_tmb"><meta property="og:description" content="fit_tmb runs a TMB model and generates standard diagnostics"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FishLife</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Access.html">Accessing predicted values</a>
    <a class="dropdown-item" href="../articles/Archetypes.html">Archetypes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="http://github.com/James-Thorson-NOAA/FishLife/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Optimize a TMB model</h1>
      <small class="dont-index">Source: <a href="http://github.com/James-Thorson-NOAA/FishLife/blob/HEAD/R/fit_tmb.R" class="external-link"><code>R/fit_tmb.R</code></a></small>
      <div class="d-none name"><code>fit_tmb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fit_tmb</code> runs a TMB model and generates standard diagnostics</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fit_tmb</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  fn <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">fn</span>,</span>
<span>  gr <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>  startpar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  getsd <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eval.max <span class="op">=</span> <span class="fl">10000</span>, iter.max <span class="op">=</span> <span class="fl">10000</span>, trace <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  bias.correct <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bias.correct.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="cn">FALSE</span>, split <span class="op">=</span> <span class="cn">NULL</span>, nsplit <span class="op">=</span> <span class="cn">NULL</span>, vars_to_correct <span class="op">=</span></span>
<span>    <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  savedir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  loopnum <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  newtonsteps <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  n <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  getReportCovariance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  getJointPrecision <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  getHessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start_time_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="st">"0:0:0"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>obj</dt>
<dd><p>The compiled TMB object</p></dd>


<dt>startpar</dt>
<dd><p>Starting values for fixed effects (default NULL uses <code>obj$par</code>)</p></dd>


<dt>lower, upper</dt>
<dd><p>vectors of lower and upper bounds, replicated to be as long as
    <code>start</code>.  If unspecified, all parameters are assumed to be
    unconstrained.</p></dd>


<dt>getsd</dt>
<dd><p>Boolean indicating whether to run standard error calculation; see <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">sdreport</a></code> for details</p></dd>


<dt>control</dt>
<dd><p>A list of control parameters. For details see <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code></p></dd>


<dt>bias.correct</dt>
<dd><p>Boolean indicating whether to do epsilon bias-correction;
see <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">sdreport</a></code> and <code>fit_tmb</code>for details</p></dd>


<dt>bias.correct.control</dt>
<dd><p>tagged list of options for epsilon bias-correction,
where <code>vars_to_correct</code> is a character-vector of ADREPORT variables that should be bias-corrected</p></dd>


<dt>savedir</dt>
<dd><p>directory to save results (if <code>savedir=NULL</code>, then results aren't saved)</p></dd>


<dt>loopnum</dt>
<dd><p>number of times to re-start optimization (where <code>loopnum=3</code>
sometimes achieves a lower final gradient than <code>loopnum=1</code>)</p></dd>


<dt>newtonsteps</dt>
<dd><p>Integer specifying the number of extra newton steps to take
after optimization (alternative to <code>loopnum</code>).
Each newtonstep requires calculating the Hessian matrix and is therefore slow.
But for well-behaved models, each Newton step will typically
decrease the maximum gradient of the loglikelihood with respect to each fixed effect,
and therefore this option can be used to achieve an arbitrarily low final gradient
given sufficient time for well-behaved models.  However, this option will also
perform strangely or have unexpected consequences for poorly-behaved models, e.g.,
when fixed effects are at upper or lower bounds.</p></dd>


<dt>n</dt>
<dd><p>sample sizes (if <code>n!=Inf</code> then <code>n</code> is used to calculate BIC and AICc)</p></dd>


<dt>getReportCovariance</dt>
<dd><p>Get full covariance matrix of ADREPORTed variables?</p></dd>


<dt>getJointPrecision</dt>
<dd><p>Optional. Return full joint precision matrix of random effects and parameters?</p></dd>


<dt>getHessian</dt>
<dd><p>return Hessian for usage in later code</p></dd>


<dt>quiet</dt>
<dd><p>Boolean whether to print additional messages results to terminal</p></dd>


<dt>start_time_elapsed</dt>
<dd><p>how much time has elapsed prior to calling fit_tmb,
for use, e.g., when calling <code>fit_tmb</code> multiple times in sequence,
where <code>start_time_elapsed = opt_previous$time_for_run</code></p></dd>


<dt>...</dt>
<dd><p>list of settings to pass to <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">sdreport</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>the standard output from <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code>, except with additional diagnostics and timing info,
        and a new slot containing the output from <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">sdreport</a></code></p>


    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>For more details see <a href="https://doi.org/10.1016/j.fishres.2015.11.016" class="external-link">https://doi.org/10.1016/j.fishres.2015.11.016</a></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by James Thorson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

